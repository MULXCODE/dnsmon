<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>environment/ParamsManager.js - DNSMON</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="DNSMON"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 14.4.15.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AggregationLevelConnector.html">AggregationLevelConnector</a></li>
            
                <li><a href="../classes/AntiFloodConnector.html">AntiFloodConnector</a></li>
            
                <li><a href="../classes/BreadcrumbsView.html">BreadcrumbsView</a></li>
            
                <li><a href="../classes/CacheConnectorAtlas.html">CacheConnectorAtlas</a></li>
            
                <li><a href="../classes/Cell.html">Cell</a></li>
            
                <li><a href="../classes/Connector.html">Connector</a></li>
            
                <li><a href="../classes/ConnectorFacade.html">ConnectorFacade</a></li>
            
                <li><a href="../classes/ControlPanelView.html">ControlPanelView</a></li>
            
                <li><a href="../classes/ErrorsHandlerConnectorAtlas.html">ErrorsHandlerConnectorAtlas</a></li>
            
                <li><a href="../classes/FullScreenView.html">FullScreenView</a></li>
            
                <li><a href="../classes/GesturesManager.html">GesturesManager</a></li>
            
                <li><a href="../classes/HistoryManager.html">HistoryManager</a></li>
            
                <li><a href="../classes/IsolationLevelConnectorAtlas.html">IsolationLevelConnectorAtlas</a></li>
            
                <li><a href="../classes/MainView.html">MainView</a></li>
            
                <li><a href="../classes/ParamsManager.html">ParamsManager</a></li>
            
                <li><a href="../classes/PopUpView.html">PopUpView</a></li>
            
                <li><a href="../classes/Row.html">Row</a></li>
            
                <li><a href="../classes/SessionManager.html">SessionManager</a></li>
            
                <li><a href="../classes/SvgChartView.html">SvgChartView</a></li>
            
                <li><a href="../classes/SvgContainerView.html">SvgContainerView</a></li>
            
                <li><a href="../classes/SvgOrdinalAxisView.html">SvgOrdinalAxisView</a></li>
            
                <li><a href="../classes/SvgTimeAxisView.html">SvgTimeAxisView</a></li>
            
                <li><a href="../classes/TemplateManagerView.html">TemplateManagerView</a></li>
            
                <li><a href="../classes/TimeController.html">TimeController</a></li>
            
                <li><a href="../classes/TimeOverviewView.html">TimeOverviewView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/connector.html">connector</a></li>
            
                <li><a href="../modules/connector.Atlas.html">connector.Atlas</a></li>
            
                <li><a href="../modules/controller.html">controller</a></li>
            
                <li><a href="../modules/environment.html">environment</a></li>
            
                <li><a href="../modules/model.html">model</a></li>
            
                <li><a href="../modules/session.html">session</a></li>
            
                <li><a href="../modules/view.html">view</a></li>
            
                <li><a href="../modules/view.svg.html">view.svg</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: environment/ParamsManager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Created by mcandela on 11/12/13.
 */

define([
    &quot;env.utils&quot;
], function(utils){

    /**
     * ParamsManager is the only component aware about the translation between external and internal parameters.
     * It allows to have high-level internal parameters expressed as visualisation terms and external domain related
     * parameters. This approach allows to easily introduce at any time new &quot;views&quot; based on different data elements
     * using the same graphic metaphor.
     *
     * @class ParamsManager
     * @constructor
     * @module environment
     */

    var ParamsManager = function(){


        /**
         * This method merges two parameters vectors
         *
         * @method mergeParams
         * @input {Object} actualParams A vector of parameters
         * @input {Object} newParams A vector of parameters
         * @return {Object} A vector of parameters
         */

        this.mergeParams = function(actualParams, newParams){
            for (var paramKey in newParams){ // MAP not Array
                actualParams[paramKey] = newParams[paramKey];
            }

            return actualParams;
        };


        /**
         * This method converts the parameters vector from the external to the internal format.
         * It is an indirection layer able to converts parameters from an external domain to a graphical domain
         * stopping at the same time the propagation of changes involving the external parameters.
         *
         * @method fromExternalToInternal
         * @input {Object} params A vector of parameters
         * @return {Object} A vector of parameters
         */

        this.fromExternalToInternal = function(params){
            var zone, server, type, startDate, selectedRows, outParams, endDate, zoneName, serverName, typeName,
                startDateName, endDateName, selectedRowsName, isTcp, ipVersion, isTcpName, ipVersionName, validatorMap,
                timeWindowName, timeWindow, filterProbesName, filterProbes;

            zoneName = &quot;zone&quot;;
            serverName = &quot;server&quot;;
            typeName = &quot;type&quot;;
            startDateName = &quot;startTime&quot;;
            endDateName = &quot;endTime&quot;;
            selectedRowsName = &quot;selectedRows&quot;;
            isTcpName = &quot;isTcp&quot;;
            ipVersionName = &quot;ipVersion&quot;;
            timeWindowName = &quot;defaultTimeWindow&quot;;
            filterProbesName = &quot;filterProbes&quot;;

            validatorMap = {
                &quot;zone&quot;: {
                    type: &quot;string&quot;
                },

                &quot;server&quot;: {
                    type: &quot;string&quot;
                },

                &quot;type&quot;: {
                    type: function(val){ return (val == &quot;zone-servers&quot; || val == &quot;server-probes&quot; || val == &quot;server-instances&quot;);},
                    message: &quot;The type param can be one of &#x27;zone-servers&#x27;, &#x27;server-probes&#x27; or &#x27;server-instances&#x27;&quot;
                },

                &quot;startTime&quot;: {
                    type: &quot;number&quot;,
                    cast: function(val){ return ((typeof val == &quot;string&quot;) ? parseInt(val) : val); }, // This is a cast for multiple types input
                    message: &quot;startTime it is not a valid Unix timestamp&quot;
                },

                &quot;endTime&quot;: {
                    type: &quot;number&quot;,
                    cast: function(val){ return ((typeof val == &quot;string&quot;) ? parseInt(val) : val); }, // This is a cast for multiple types input
                    message: &quot;endTime it is not a valid Unix timestamp&quot;
                },

                &quot;selectedRows&quot;: {
                    type: &quot;string&quot;,
                    message: &quot;The selectedRows params must be a list of comma-separated ids&quot;
                },

                &quot;ipVersion&quot;: {
                    type: function(val){ return (val == &quot;6&quot; || val == &quot;4&quot; || val == &quot;both&quot;);},
                    cast: function(val){ return (val == &quot;6&quot; || val == &quot;4&quot;) ? parseInt(val) : &quot;both&quot;; }, // This is a cast for multiple types input
                    message: &quot;The ipVersion param can be &#x27;4&#x27;, &#x27;6&#x27; or &#x27;both&#x27;&quot;
                },

                &quot;isTcp&quot;: {
                    type: &quot;boolean&quot;,
                    cast: function(val){
                        return ((typeof val == &quot;string&quot;) ? (val == &quot;true&quot;) : val);// This is a cast for multiple types input
                    }
                },

                &quot;filterProbes&quot;: {
                    type: &quot;boolean&quot;,
                    cast: function(val){
                        return ((typeof val == &quot;string&quot;) ? (val == &quot;true&quot;) : val);// This is a cast for multiple types input
                    }
                },

                &quot;defaultTimeWindow&quot;: {
                    type: function(val){ return (val == &quot;5h&quot; || val == &quot;1d&quot; || val == &quot;1w&quot; || val == &quot;1m&quot;);},
                    message: &quot;The defaultTimeWindow param can be &#x27;5h&#x27;, &#x27;1d&#x27;, &#x27;1w&#x27;, or &#x27;1m&#x27; or an interval expressed in seconds&quot;
                }
            };

            params = this._helper(validatorMap, params);

            outParams = {};

            zone = params[zoneName];
            server = params[serverName];
            type = params[typeName];
            startDate = params[startDateName];
            endDate = params[endDateName];
            timeWindow = params[timeWindowName];
            selectedRows = params[selectedRowsName];
            filterProbes = params[filterProbesName];
            isTcp = params[isTcpName];
            ipVersion = params[ipVersionName];

            if (server){ // ??
                outParams.group = this.convertRemoteToLocalId(server);
                if (zone) outParams.root = this.convertRemoteToLocalId(zone);
            }else{
                if (zone) outParams.group = this.convertRemoteToLocalId(zone);
            }

            if (type) outParams.type = this.convertRemoteToLocalType(type);
            if (filterProbes != null) outParams.filterProbes = filterProbes;

            if (startDate) outParams.startDate = this.convertRemoteToLocalDate(startDate);
            if (endDate) outParams.endDate = this.convertRemoteToLocalDate(endDate);

            if (selectedRows != null) outParams.selectedRows = ((selectedRows != &#x27;&#x27;) ? $.map(selectedRows.split(&#x27;,&#x27;), this.convertRemoteToLocalId) : []);


            if (ipVersion) outParams.ipVersion = ((ipVersion == &#x27;both&#x27;) ? null : ipVersion);
            if (timeWindow) outParams.timeWindow = this.convertRemoteToLocalTimeWindow(timeWindow);

            if (isTcp != null) outParams.isTcp = isTcp;

            return outParams;
        };


        /**
         * This method converts the parameters vector from the internal to the external format.
         * It is the opposite of fromExternalToInternal.
         *
         * @method fromInternalToExternal
         * @input {Object} params A vector of parameters
         * @return {Object} A vector of parameters
         */

        this.fromInternalToExternal = function(params){
            var zone, server, outParams, zoneName, serverName, typeName, startDateName, endDateName, selectedRowsName,
                ipVersionName, isTcpName, timeWindowName, filterProbesName;

            zoneName = &quot;zone&quot;;
            serverName = &quot;server&quot;;
            typeName = &quot;type&quot;;
            startDateName = &quot;startTime&quot;;
            endDateName = &quot;endTime&quot;;
            selectedRowsName = &quot;selectedRows&quot;;
            ipVersionName = &quot;ipVersion&quot;;
            isTcpName = &quot;isTcp&quot;;
            timeWindowName = &quot;timeWindow&quot;;
            filterProbesName = &quot;filterProbes&quot;;

            outParams = {};

            if (params.type) outParams[typeName] = this.convertLocalToRemoteType(params.type);

            if (params.root){
                outParams[serverName] = (params.group) ? this.convertLocalToRemoteId(params.group) : null;
                outParams[zoneName] = this.convertLocalToRemoteId(params.root);
            }else{
                outParams[serverName] = null;
                outParams[zoneName] = (params.group) ? this.convertLocalToRemoteId(params.group) : null;
            }

//            if (params.startDate) outParams[startDateName] = this.convertLocalToRemoteDate(params.startDate);
//            if (params.endDate) outParams[endDateName] = this.convertLocalToRemoteDate(params.endDate);
//            if (params.selectedRows) outParams[selectedRowsName] = $.map(params.selectedRows, this.convertLocalToRemoteId);
//
//            if (params.hasOwnProperty(&quot;filterProbes&quot;)) outParams[filterProbesName] = params.filterProbes;
//
//            if (params.timeWindow) outParams[timeWindowName] = this.convertLocalToRemoteTimeWindow(params.timeWindow);
//
//            outParams[ipVersionName] = params.ipVersion || &#x27;both&#x27;;
//
//            if (params.hasOwnProperty(&quot;isTcp&quot;)) outParams[isTcpName] = params.isTcp;



            outParams[startDateName] =  (params.startDate) ? this.convertLocalToRemoteDate(params.startDate) : null;

            outParams[endDateName] = (params.endDate)  ? this.convertLocalToRemoteDate(params.endDate) : null;
            outParams[selectedRowsName] = (params.selectedRows) ? $.map(params.selectedRows, this.convertLocalToRemoteId) : [];

            outParams[filterProbesName] = params.filterProbes;

            outParams[timeWindowName] = (params.timeWindow) ? this.convertLocalToRemoteTimeWindow(params.timeWindow) : null;

            outParams[ipVersionName] = params.ipVersion || &#x27;both&#x27;;

            outParams[isTcpName] = params.isTcp;

            return outParams;
        };


        /**
         * This method is an input checker for the external parameters.
         *
         * @method _helper
         * @private
         * @input {Object} validationMap A validation Map composed of types, cast functions and error messages
         * @input {Object} parameters A vector of parameters
         * @return {Object} A vector of parameters cased with the cast functions described in the validationMap
         */

        this._helper = function(validationMap, parameters){
            var validationItem, validator, messages, value;

            messages = [];

            for (var parameter in parameters){

                validationItem = validationMap[parameter];
                value = parameters[parameter];

                if (value &amp;&amp; validationItem){

                    if (validationItem.cast){
                        parameters[parameter] = validationItem.cast(value);
                        value = parameters[parameter];
                    }

                    validator = (typeof validationItem.type == &quot;function&quot;) ? validationItem.type : function(val){ return (typeof val == validationItem.type); };

                    if (!validator(value)){
                        if (validationItem.message){
                            messages.push(validationItem.message);
                        }else{
                            messages.push(parameter + &quot; must be a &quot; + validationItem.type);
                        }
                    }
                }
            }

            if (messages.length &gt; 0){
                alert(&quot;Input errors: &quot; + messages.join(&#x27;, &#x27;));
            }

            return parameters;
        };


        /**
         * This method initializes an empty/default vector of parameters
         *
         * @method createInternalParamVector
         * @return {Object} A vector of parameters
         */

        this.createInternalParamVector = function(){
            return {
                startDate: null,
                endDate : null,
                type: null,
                group: null,
                root: null,
                selectedRows: [],
                ipVersion: null,
                isTcp: null,
                filterProbes: false,
                defaultTimeWindow: null
            };
        };


        /**
         * This method converts IDs from the external to the internal format
         *
         * @method convertRemoteToLocalId
         * @input {String} remoteId An ID in the external format
         * @return {String} An ID in the internal format
         */

        this.convertRemoteToLocalId = function(remoteId){
            return new String(remoteId)
                .replace(/\./g, &#x27;dnsmndt&#x27;)
                .replace(/\:/g, &#x27;dnsmnsmcl&#x27;);
        };


        /**
         * This method converts IDs from the internal to the external format
         *
         * @method convertLocalToRemoteId
         * @input {String} remoteId An ID in the internal format
         * @return {String} An ID in the external format
         */

        this.convertLocalToRemoteId = function(localId){
            return new String(localId)
                .replace(/dnsmndt/g, &#x27;.&#x27;)
                .replace(/dnsmnsmcl/g, &#x27;:&#x27;);
        };


        /**
         * This method converts Dates from the internal to the external format
         *
         * @method convertLocalToRemoteDate
         * @input {Date} local A Date object
         * @return {Number} A Unix timestamp
         */

        this.convertLocalToRemoteDate = function(local){
            return (!local) ? null : utils.dateToUTCTimestamp(local);
        };


        /**
         * This method converts Dates from the external to the internal format
         *
         * @method convertRemoteToLocalDate
         * @input {Date} remote A date object in the external format
         * @return {Number} A Unix timestamp
         */

        this.convertRemoteToLocalDate = function(remote){
            return (!remote) ? null : utils.timestampToLocalDate(remote);
        };


        /**
         * This method converts Types from the external to the internal format
         *
         * @method convertRemoteToLocalType
         * @input {String} remote A Type in the external format
         * @return {String} A Type in the internal format
         */

        this.convertRemoteToLocalType = function(remote){
            var out;

            switch(remote){
                case &quot;zone-servers&quot;:
                    out = &quot;servers&quot;;
                    break;

                case &quot;server-probes&quot;:
                    out = &quot;probes&quot;;
                    break;
            }

            return out;
        };


        /**
         * This method converts types from the internal to the external format
         *
         * @method convertLocalToRemoteType
         * @input {String} local A Type in the internal format
         * @return {String} A Type in the external format
         */

        this.convertLocalToRemoteType = function(local){
            var out;

            switch(local){
                case &quot;servers&quot;:
                    out = &quot;zone-servers&quot;;
                    break;

                case &quot;probes&quot;:
                    out = &quot;server-probes&quot;;
                    break;
            }

            return out;
        };


        /**
         * This method converts time windows from the external to the internal format
         *
         * @method convertRemoteToLocalTimeWindow
         * @input {Object} remote A time window can be expressed as a string (i.e. &quot;5h&quot;, &quot;1d&quot;, &quot;1w&quot;, &quot;1m&quot;) or as an amount of seconds
         * @return {Number} A time window expressed in seconds
         */

        this.convertRemoteToLocalTimeWindow = function(remote){
            var value;

            if (typeof remote == &#x27;string&#x27;){

                switch(remote){

                    case &quot;5h&quot;:
                        value = 5 * 3600;
                        break;

                    case &quot;1d&quot;:
                        value = 24 * 3600;
                        break;

                    case &quot;1w&quot;:
                        value = 7 * 24 * 3600;
                        break;

                    case &quot;1m&quot;:
                        value = 30 * 24 * 3600;
                        break;
                }
            }else{
                value = remote;
            }

            return value; // seconds
        };


        /**
         * This method converts time windows from the internal to the external format
         *
         * @method convertLocalToRemoteTimeWindow
         * @input {Number} local A time window expressed in seconds
         * @return {Object} A time window expressed in seconds, in future also strings can be used
         */

        this.convertLocalToRemoteTimeWindow = function(local){
            return local; // No conversion
        }



    };

    return new ParamsManager(); //singleton
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
